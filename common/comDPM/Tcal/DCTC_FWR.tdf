% C:\PROJECTS\ICECUBE\DOR\FPGA\DCOM_01\TCAL\DCTC_FWR.tdf %
% AHDL code created by Visual Software Solution's StateCAD 4.11 %
% Tue Jul 13 18:11:47 2004 %

% This AHDL code was generated using: %
%  binary encoded state assignment with structured code format. %
%  Minimization is enabled,  implied else is enabled,  %
%  and outputs are speed optimized. %

SUBDESIGN DCTC_FWR(
	CLK :	INPUT;
	edge_end :	INPUT;
	msg_sent :	INPUT;
	one_lev :	INPUT;
	res :	INPUT;
	tcal_prec :	INPUT;
	tcwf_rd_next :	INPUT;
	wfm_ct_cout :	INPUT;
	pulse_rcvd :	OUTPUT;
	rx_time_lat :	OUTPUT;
	tcwf_aclr :	OUTPUT;
	tcwf_rdreq :	OUTPUT;
	tcwf_wrreq :	OUTPUT;
	wfm_ct_clk_en :	OUTPUT;
	wfm_ct_sload :	OUTPUT;
	wfm_data_val :	OUTPUT;
)


VARIABLE
	sreg : MACHINE OF BITS (SV0, SV1, SV2, SV3)
		WITH STATES (
			IDLE =	B"0101",
			CHEK_EF =	B"0000",
			DAT_VALID =	B"0001",
			EXP_EDGE =	B"0010",
			EXP_EXTREM =	B"0011",
			FWR =	B"0100",
			LD_AF_CT =	B"0110",
			RD_NEXT =	B"0111",
			RxTIME =	B"1000",
			SENT_WT =	B"1001"
		);

	pulse_rcvd :	DFF;
	rx_time_lat :	DFF;
	tcwf_aclr :	DFF;
	tcwf_rdreq :	DFF;
	tcwf_wrreq :	DFF;
	wfm_ct_clk_en :	DFF;
	wfm_ct_sload :	DFF;
	wfm_data_val :	DFF;

BEGIN

% Clock setup %
	pulse_rcvd.clk=CLK;
	rx_time_lat.clk=CLK;
	tcwf_aclr.clk=CLK;
	tcwf_rdreq.clk=CLK;
	tcwf_wrreq.clk=CLK;
	wfm_ct_clk_en.clk=CLK;
	wfm_ct_sload.clk=CLK;
	wfm_data_val.clk=CLK;
	sreg.clk=CLK;

	sreg.reset =  res ;

	IF ( res ) THEN
		pulse_rcvd.clrn=GND;
		wfm_data_val.clrn=GND;
		rx_time_lat.clrn=GND;
		wfm_ct_sload.clrn=GND;
		wfm_ct_clk_en.clrn=GND;
		tcwf_aclr.prn=GND;
		tcwf_rdreq.clrn=GND;
		tcwf_wrreq.clrn=GND;
	ELSE
		pulse_rcvd.clrn=VCC;
		wfm_data_val.clrn=VCC;
		rx_time_lat.clrn=VCC;
		wfm_ct_sload.clrn=VCC;
		wfm_ct_clk_en.clrn=VCC;
		tcwf_aclr.prn=VCC;
		tcwf_rdreq.clrn=VCC;
		tcwf_wrreq.clrn=VCC;
	END IF;

	CASE sreg IS
		WHEN CHEK_EF =>
			IF ( !wfm_ct_cout ) THEN 
				sreg = DAT_VALID;
				(pulse_rcvd,wfm_data_val,rx_time_lat,wfm_ct_sload,wfm_ct_clk_en,tcwf_aclr
					,tcwf_rdreq,tcwf_wrreq)=(0,1,0,0,0,0,0,0);
			END IF;
			IF ( wfm_ct_cout ) THEN 
				sreg = SENT_WT;
				(pulse_rcvd,wfm_data_val,rx_time_lat,wfm_ct_sload,wfm_ct_clk_en,tcwf_aclr
					,tcwf_rdreq,tcwf_wrreq)=(0,0,0,0,0,0,0,0);
			END IF;
		WHEN DAT_VALID =>
			IF ( tcwf_rd_next ) THEN 
				sreg = RD_NEXT;
				(pulse_rcvd,wfm_data_val,rx_time_lat,wfm_ct_sload,wfm_ct_clk_en,tcwf_aclr
					,tcwf_rdreq,tcwf_wrreq)=(0,0,0,0,1,0,1,0);
			ELSE
				sreg = DAT_VALID;
				(pulse_rcvd,wfm_data_val,rx_time_lat,wfm_ct_sload,wfm_ct_clk_en,tcwf_aclr
					,tcwf_rdreq,tcwf_wrreq)=(0,1,0,0,0,0,0,0);
			END IF;
		WHEN EXP_EDGE =>
			IF ( one_lev ) THEN 
				sreg = EXP_EXTREM;
				(pulse_rcvd,wfm_data_val,rx_time_lat,wfm_ct_sload,wfm_ct_clk_en,tcwf_aclr
					,tcwf_rdreq,tcwf_wrreq)=(0,0,1,0,0,0,1,1);
			ELSE
				sreg = EXP_EDGE;
				(pulse_rcvd,wfm_data_val,rx_time_lat,wfm_ct_sload,wfm_ct_clk_en,tcwf_aclr
					,tcwf_rdreq,tcwf_wrreq)=(0,0,0,0,0,0,1,1);
			END IF;
		WHEN EXP_EXTREM =>
			IF ( edge_end ) THEN 
				sreg = RxTIME;
				(pulse_rcvd,wfm_data_val,rx_time_lat,wfm_ct_sload,wfm_ct_clk_en,tcwf_aclr
					,tcwf_rdreq,tcwf_wrreq)=(1,0,0,1,1,0,0,0);
			ELSE
				sreg = EXP_EXTREM;
				(pulse_rcvd,wfm_data_val,rx_time_lat,wfm_ct_sload,wfm_ct_clk_en,tcwf_aclr
					,tcwf_rdreq,tcwf_wrreq)=(0,0,1,0,0,0,1,1);
			END IF;
		WHEN FWR =>
			IF ( wfm_ct_cout ) THEN 
				sreg = EXP_EDGE;
				(pulse_rcvd,wfm_data_val,rx_time_lat,wfm_ct_sload,wfm_ct_clk_en,tcwf_aclr
					,tcwf_rdreq,tcwf_wrreq)=(0,0,0,0,0,0,1,1);
			ELSE
				sreg = FWR;
				(pulse_rcvd,wfm_data_val,rx_time_lat,wfm_ct_sload,wfm_ct_clk_en,tcwf_aclr
					,tcwf_rdreq,tcwf_wrreq)=(0,0,0,0,1,0,0,1);
			END IF;
		WHEN IDLE =>
			IF ( tcal_prec ) THEN 
				sreg = LD_AF_CT;
				(pulse_rcvd,wfm_data_val,rx_time_lat,wfm_ct_sload,wfm_ct_clk_en,tcwf_aclr
					,tcwf_rdreq,tcwf_wrreq)=(0,0,0,1,1,0,0,0);
			ELSE
				sreg = IDLE;
				(pulse_rcvd,wfm_data_val,rx_time_lat,wfm_ct_sload,wfm_ct_clk_en,tcwf_aclr
					,tcwf_rdreq,tcwf_wrreq)=(0,0,0,0,0,1,0,0);
			END IF;
		WHEN LD_AF_CT =>
			sreg = FWR;
			(pulse_rcvd,wfm_data_val,rx_time_lat,wfm_ct_sload,wfm_ct_clk_en,tcwf_aclr,
				tcwf_rdreq,tcwf_wrreq)=(0,0,0,0,1,0,0,1);
		WHEN RD_NEXT =>
			sreg = CHEK_EF;
			(pulse_rcvd,wfm_data_val,rx_time_lat,wfm_ct_sload,wfm_ct_clk_en,tcwf_aclr,
				tcwf_rdreq,tcwf_wrreq)=(0,0,0,0,0,0,0,0);
		WHEN RxTIME =>
			sreg = DAT_VALID;
			(pulse_rcvd,wfm_data_val,rx_time_lat,wfm_ct_sload,wfm_ct_clk_en,tcwf_aclr,
				tcwf_rdreq,tcwf_wrreq)=(0,1,0,0,0,0,0,0);
		WHEN SENT_WT =>
			IF ( msg_sent ) THEN 
				sreg = IDLE;
				(pulse_rcvd,wfm_data_val,rx_time_lat,wfm_ct_sload,wfm_ct_clk_en,tcwf_aclr
					,tcwf_rdreq,tcwf_wrreq)=(0,0,0,0,0,1,0,0);
			ELSE
				sreg = SENT_WT;
				(pulse_rcvd,wfm_data_val,rx_time_lat,wfm_ct_sload,wfm_ct_clk_en,tcwf_aclr
					,tcwf_rdreq,tcwf_wrreq)=(0,0,0,0,0,0,0,0);
			END IF;
	END CASE;

END;
